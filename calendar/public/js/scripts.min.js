const $ = require(process.cwd() + '/public/js/jquery-3.1.1.min.js');
const eventData = require(process.cwd() + '/data/eventData.js');
(function () {
    $(document).ready(function () {
        
        if ($('.month').length) {

            eventData.getEvents().then(function (events) {
                // Fill in events for each day of the month
                $('.day:not(.filler)').each(function () {
                    var dayEvents = events[$(this).attr('id')];

                    if (dayEvents) {
                        var html = '<ul class="events">';

                        for (let event of dayEvents) {
                            html += '<li>' + event.title + '</li>';
                        }

                        html += '</ul>'

                        $(this).addClass('has-events').append(html);
                    }
                });
            });
        }
    });
})();
(function () {
    $(document).ready(function () {
        var dateId = $('#left-panel').data('dateid');

        if (dateId) {
            eventData.getEvents().then(function (events) {

                var dayEvents = events[dateId];

                var month = +dateId.substring(0, dateId.indexOf('-'));
                var date = +dateId.substring(dateId.indexOf('-') + 1, dateId.lastIndexOf('-'));
                var year = +dateId.substring(dateId.lastIndexOf('-') + 1, dateId.length);

                // Fill in events the current day
                var html = '<ul class="events">';

                for (let event of dayEvents) {
                    html += '<li><a href="/' + month + '/' + date + '/' + year + '/' + event.id + '">' + event.title + '</a></li>';
                }

                html += '</ul>'

                $('#events').html(html);
            });
        }
    });
})();
(function() {
    $(document).ready(function() {
        $('#new-event-form').submit(function(e) {
            e.preventDefault();

            $('#new-event-form .alert-danger').hide();

            // Grab data from serialized form
            var data = $(e.target).serializeArray().reduce(function(obj, item) {
                if (!isNaN(item.value)) {
                    obj[item.name] = +item.value;
                } else {
                    obj[item.name] = item.value;
                }
                return obj;
            }, {});

            var month = +$(e.target).data('month');
            var year = +$(e.target).data('year');
            var date = +data.date;

            try {
                eventData.addEvent(new Date(year, month, date), data).then(function(ret) {
                    window.location = $('#home-btn').attr('href');
                });
            } catch (e) {
                $('#new-event-form .alert-danger').text(e);
                $('#new-event-form .alert-danger').show();
            }
        });
    });
})();

(function () {
    $(document).ready(function () {
        var dateId = $('#event-data').data('dateid');
        var eventId = $('#event-data').data('eventid')

        if (dateId && eventId) {

            eventData.getEvents().then(function (events) {
                var event = events[dateId].filter(function (e) {
                    return e.id === eventId;
                })[0];

                var month = +dateId.substring(0, dateId.indexOf('-'));
                var date = +dateId.substring(dateId.indexOf('-') + 1, dateId.lastIndexOf('-'));
                var year = +dateId.substring(dateId.lastIndexOf('-') + 1, dateId.length);

                $('#event-title').text(event.title);
                $('#event-date').text((month + 1) + '/' + date + '/' + year);
                $('#event-location').text(event.location);
                $('#event-description').text(event.description);
            });
        }
    });
})();